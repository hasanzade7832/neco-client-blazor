@inherits LayoutComponentBase
@using MudBlazor

<HeadContent>
    <!-- استایل‌های پروژه -->
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="Dashboard.css" />
    <link rel="stylesheet" href="css/app.min.css" />
    <link rel="stylesheet" href="_content/MudBlazor/MudBlazor.min.css" />
</HeadContent>

<MudThemeProvider Theme="AppThemes.KargardoonTheme" @bind-IsDarkMode="_isDarkMode" />
<MudDialogProvider />
<MudSnackbarProvider />
<MudPopoverProvider />

<!-- به‌روزرسانی Breakpoint در هر Resize / Zoom -->
<MudBreakpointProvider OnBreakpointChanged="bp => _bp = bp" />

<MudLayout Style="@LayoutStyle" Class="root-layout">
    <NavMenu SidebarOpen="_sidebarOpen" @bind-IsDarkMode="_isDarkMode" />
    <SideBar OnSidebarToggled="open => _sidebarOpen = open" IsDarkMode="_isDarkMode" />

    <MudMainContent Style="@MainContentStyle">
        <div style="@InnerContentStyle">
            @Body
        </div>
    </MudMainContent>
</MudLayout>

@code {
    /* ------- وضعیت‌ها ------- */
    private bool _isDarkMode;
    private bool _sidebarOpen = true;
    private Breakpoint _bp;

    /* ------- تنظیمات قابل تغییر ------- */
    // هر چیزی کوچک‌تر از این Breakpoint «موبایل» حساب می‎شود
    private const Breakpoint FreeScrollFrom = Breakpoint.Lg;   // ← اگر خواستید دقیق‌تر کنید، این را کم/زیاد کنید

    /* ------- استایل‌ها ------- */
    private string LayoutStyle =>
        _bp < FreeScrollFrom
            // موبایل یا زوم بالا
            ? "height:auto; overflow-y:auto;"
            // دسکتاپ عادی
            : "height:100dvh; overflow:hidden;";

    private string MainContentStyle =>
        $"padding-left:{(_sidebarOpen ? "250px" : "56px")};" +
        $"padding-right:32px;" +
        $"padding-top:64px;" +
        $"padding-bottom:24px;" +
        $"box-sizing:border-box;" +
        $"width:100%;" +
        $"min-height:calc(100dvh - 0px);" +  /* استفاده از 100dvh */
        $"height:auto;" +
        $"overflow-y:auto !important;" +    /* اسکرول محتوا همیشه فعال */
        $"background-color:var(--mud-palette-background);" +
        $"transition:padding-left 300ms ease;";

    private string InnerContentStyle =>
        $"max-width:1200px;" +
        $"margin:0 auto;" +
        $"width:100%;";
}