@page "/test"
@using MudBlazor

@* 10 ردیف پیش‌فرض + ارتفاع متناسب *@
<MudDataGrid T="Element"
             Items="@Elements"
             FixedHeader="true"
             Height="@_gridHeight"
             RowClassFunc="@_rowClassFunc"
             RowStyleFunc="@_rowStyleFunc"
             Filterable="true"
             FilterMode="DataGridFilterMode.Simple"
             FilterCaseSensitivity="DataGridFilterCaseSensitivity.CaseInsensitive"
             QuickFilter="@_quickFilter"
             SortMode="SortMode.Multiple"
             Hideable="false"
             Groupable="false"
             @bind-CurrentPage="_page"
             @bind-RowsPerPage="_rowsPerPage">

    <ToolBarContent>
        <MudText Typo="Typo.h6">Periodic Elements</MudText>
        <MudSpacer />
        <MudTextField @bind-Value="_searchString"
                      Placeholder="Search"
                      Immediate="true"
                      Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search"
                      Class="mt-0" />
    </ToolBarContent>

    <Columns>
        <PropertyColumn Property="x => x.Number" Title="Nr" Sortable="false" Filterable="true" />
        <PropertyColumn Property="x => x.Sign" Filterable="true" />
        <PropertyColumn Property="x => x.Name" FilterMode="DataGridFilterMode.ColumnFilterMenu" />
        <PropertyColumn Property="x => x.Position" Filterable="true" />
        <PropertyColumn Property="x => x.Molar" Title="Molar mass" Filterable="true" />
    </Columns>

    <PagerContent>
        <div class="pager-center">
            <MudDataGridPager T="Element"
                              @bind-CurrentPage="_page"
                              @bind-RowsPerPage="_rowsPerPage"
                              PageSizeOptions="new int[] { 5, 10, 15, 20 }"
                              RowsPerPageString="Rows per page" />
        </div>
    </PagerContent>
</MudDataGrid>

@code {
    /* ---------- متغیرهای حالت گرید ---------- */
    private int _page = 0;
    private int _rowsPerPage = 10;       // ← پیش‌فرض ۱۰
    private const int _rowHeight = 48;   // ارتفاع یک ردیف در تم استاندارد
    // private string _gridHeight => $"{_rowsPerPage * _rowHeight + 110 * 2}px";
    private string _gridHeight => $"{(_rowsPerPage * _rowHeight + 110) * 2}px";


    /* ---------- داده‌ی نمونه ---------- */
    private IEnumerable<Element> Elements = Enumerable
        .Range(1, 1000)                  // کافی برای چند صفحه
        .Select(i => new Element
            {
                Number = i,
                Sign = $"E{i:000}",
                Name = $"Element {i}",
                Position = ((i - 1) % 18) + 1,
                Molar = Math.Round(1.008 + i * 0.125 + ((i % 7) * 0.037), 3)
            });

    /* ---------- سرچِ سریع ---------- */
    private string _searchString = string.Empty;
    private Func<Element, bool> _quickFilter => x =>
        string.IsNullOrWhiteSpace(_searchString) ||
        x.Sign.Contains(_searchString, StringComparison.OrdinalIgnoreCase) ||
        x.Name.Contains(_searchString, StringComparison.OrdinalIgnoreCase) ||
        $"{x.Number} {x.Position} {x.Molar}".Contains(_searchString, StringComparison.OrdinalIgnoreCase);

    /* ---------- استایل سطرها ---------- */
    private Func<Element, int, string> _rowStyleFunc => (_, i) => (i % 4) switch
    {
        0 => "background-color:rgba(var(--mud-palette-success-rgb),0.18);",
        1 => "background-color:#ffffff;",
        2 => "background-color:rgba(var(--mud-palette-warning-rgb),0.18);",
        _ => "background-color:rgba(var(--mud-palette-error-rgb),0.18);"
    };

    private Func<Element, int, string> _rowClassFunc => (_, i) => i % 4 == 1 ? "white-row" : null;

    /* ---------- مدل داده ---------- */
    public class Element
    {
        public int Number { get; set; }
        public string Sign { get; set; }
        public string Name { get; set; }
        public int Position { get; set; }
        public double Molar { get; set; }
    }
}
