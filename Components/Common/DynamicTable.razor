@page "/test111113"
@using System.Linq
@using MudBlazor

<div class="wrapper">
    <!-- نمایش تعداد سطرهای انتخاب-شده -->
    <MudText Typo="Typo.subtitle2" Class="mb-2">
        Rows per page: @_rowsPerPage
    </MudText>

    <!-- دیتاگرید با هدر ثابت و پیجر چسبیده -->
    <MudDataGrid T="Element"
                 Items="@FilteredElements"
                 Class="my-fixed-grid"
                 FixedHeader="true"
                 RowClassFunc="@_rowClassFunc"
                 RowStyleFunc="@_rowStyleFunc"
                 Filterable="true"
                 FilterMode="DataGridFilterMode.Simple"
                 FilterCaseSensitivity="DataGridFilterCaseSensitivity.CaseInsensitive"
                 SortMode="SortMode.Multiple"
                 Hideable="false"
                 Groupable="false"
                 @bind-CurrentPage="_page"
                 @bind-RowsPerPage="_rowsPerPage">

        <!-- نوار ابزار -->
        <ToolBarContent>
            <MudText Typo="Typo.h6">Tasks</MudText>
            <MudSpacer />
            <MudTextField Value="_searchString"
                          Immediate="true"
                          ValueChanged="@((string s) => { _searchString = s; _page = 0; })"
                          Placeholder="Search"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Search"
                          Class="mt-0" />
        </ToolBarContent>

        <!-- ستون‌ها -->
        <Columns>
            <PropertyColumn Property="x => x.Number" Title="Nr" Sortable="false" Filterable="true" />
            <PropertyColumn Property="x => x.Sign" Filterable="true" />
            <PropertyColumn Property="x => x.Name" FilterMode="DataGridFilterMode.ColumnFilterMenu" />
            <PropertyColumn Property="x => x.Position" Filterable="true" />
            <PropertyColumn Property="x => x.Molar" Title="Molar mass" Filterable="true" />
        </Columns>

        <!-- پیجر -->
        <PagerContent>
            <div class="pager-center">
                <MudDataGridPager T="Element"
                                  @bind-CurrentPage="_page"
                                  @bind-RowsPerPage="_rowsPerPage"
                                  PageSizeOptions="new int[] { 10, 20, 30 }"
                                  RowsPerPageString="Rows per page" />
            </div>
        </PagerContent>
    </MudDataGrid>
</div>

@code {
    /* ---------- صفحه‌بندی ---------- */
    private int _page = 0;
    private int _rowsPerPage = 10;

    /* ---------- داده ساختگی ---------- */
    private IEnumerable<Element> Elements = Enumerable
        .Range(1, 1000)
        .Select(i => new Element
            {
                Number = i,
                Sign = $"E{i:000}",
                Name = $"Element {i}",
                Position = ((i - 1) % 18) + 1,
                Molar = Math.Round(1.008 + i * 0.125 + ((i % 7) * 0.037), 3)
            });

    /* ---------- جست‌وجو ---------- */
    private string _searchString = string.Empty;

    private IEnumerable<Element> FilteredElements => Elements.Where(x =>
        string.IsNullOrWhiteSpace(_searchString) ||
        x.Sign.Contains(_searchString, StringComparison.OrdinalIgnoreCase) ||
        x.Name.Contains(_searchString, StringComparison.OrdinalIgnoreCase) ||
        $"{x.Number} {x.Position} {x.Molar}".Contains(_searchString, StringComparison.OrdinalIgnoreCase));

    /* ---------- رنگ‌بندی ردیف‌ها ---------- */
    private Func<Element, int, string> _rowStyleFunc => (_, i) => (i % 4) switch
    {
        0 => "background-color:rgba(var(--mud-palette-success-rgb),0.18);",
        1 => "background-color:rgba(255,255,255,1);",
        2 => "background-color:rgba(var(--mud-palette-warning-rgb),0.18);",
        _ => "background-color:rgba(var(--mud-palette-error-rgb),0.18);"
    };

    private Func<Element, int, string> _rowClassFunc => (_, i) => i % 4 == 1 ? "white-row" : null;

    /* ---------- مدل ---------- */
    public class Element
    {
        public int Number { get; set; }
        public string Sign { get; set; }
        public string Name { get; set; }
        public int Position { get; set; }
        public double Molar { get; set; }
    }
}
